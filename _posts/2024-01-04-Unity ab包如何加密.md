---
layout: post
title: "Unity ab包如何加密"
date: 2024-01-04 16:26:10 +0800
categories: 游戏安全
tags: unity  ab包加密  游戏加密
---

「ab包」全称为 AssetBundle ，是Unity提供的一种资源存储压缩包。其中储存了游戏的资源，如图片、模型、纹理、音视频、代码等文件。<!-- more -->  

由于ab包具有灵活储存、支持热更、包体较小且便于管理等优势，已经成为了市面上主流的游戏资源压缩方式。  

ab包中图片、模型、视频等文件，是游戏的重要资源，如果被破解者或竞争对手解开，获取里面的内容，将会引发严重的竞品抄袭、知识产权受损问题。  

![315_21](/assets/res/202103/资源泄露抄袭.png)  
《光环4》发生过美术素材被抄袭事件(上《光环4》;下《群星》)  

此外，ab包被破解，也会对游戏运营产生严重影响。如一些内容驱动的游戏，ab包内会储存一些未上线的活动资源，如果被提前解开剧透，将会降低玩家的惊喜感与活动体验，对游戏的运营节奏产生负面影响。  

在一些射击竞技类游戏中，游戏的资源材质被破解、篡改还会产生意想不到的外挂效果，会严重破坏游戏的公平性，导致玩家流失，厂商收益受损。  

![315_21](/assets/res/202103/fps资源加密.gif)  
某FPS游戏资源素材被破解出现了透视外挂  

接下来，我们将重点分析，该如何对ab包进行加密。  

市面上有不少针对ab包加密的方法，网上也能找到相关的加密文章，如雨松mono提供的方案，对整个资源做加密。  

虽然满足了资源加密的需求，但这种方法的缺点非常明显，ab包占到游戏很大体积的比例，如果全部进行加密，对游戏的性能影响严重。  

如何对游戏ab资源进行加密的同时，保证解密的消耗小，降低游戏性能负担，成了许多游戏的痛点。  

对此，FairGuard研发团队花费大量时间，对unity引擎做黑盒分析，理清了Assetbundle的加载机理以及其文件结构，精心构造了一套加密方案：  

首先，通过对Assetbundle文件进行结构解析，找到资源文件的核心文件块，对核心文件块进行加密。在游戏运行时，对unity引擎Assetbundle加载时机进行埋点，在埋点处对核心文件块进行解密。  

这样构造方案既可以满足加密保护的同时，还具备运行消耗小的特点，解决了游戏资源加密的行业痛点，还有以下几个优点：  

▶ 速度快，无感知  

加密方案只对核心关键位置做加密处理，对游戏加载速度、运行流程程度的几乎没有影响，实现了无感知。  

▶ 加密强度高  

加解密算法进行了自定义混淆，让破解者无法分析出算法，算法流程图如下所示：  

![315_21](/assets/res/202103/资源加密算法流程.png)  
FairGuard算法流程图  

▶ 兼容性高  

通过 Android SO 加壳或 iOS 静态 hook 导入的纯 native 方案，兼容所有 32 位和 64 位指令集。  

▶ 解密速度非常快  

核心文件块很小，不随整个资源文件大小而变化。使用主流手机测试，300个资源文件一次性解密，额外增加的解密时间不到10ms。  

对加密算法进行了高强度自定义混淆，混淆经过精心设计，在增加复杂度的同时，兼顾了效率，运行开销很小。  

▶ 支持 Android / iOS / PC 三平台  

▶ 操作便捷，接入成本低  

使用非常简单，只要运行一个命令行即可完成对整个游戏资源的加密。  

![315_21](/assets/res/202103/资源加密使用方法.png)  
FairGuard Unity资源加密示意图  

这个命令行对游戏资源加密的同时，也会对游戏内的脚本做 mono dll 加密或者il2cpp加密。  

同时可根据配置选项，增加防破解、反修改器、反变速、反调试、反虚拟机、反云手机等多项功能，对游戏进一步加固防护，可有效解决游戏面临的各项安全问题。目前，该方案已接入多款热门游戏并验证了出色的保护能力。  


**丨结语**  

FairGuard作为专注于游戏安全领域的第三方服务商，致力于帮助游戏公司解决外挂和破解问题，为游戏提供深度一体化的加密保护方案。  

目前产品已经被FunPlus、三七互娱、恺英网络、心动、杭州电魂等多家头部公司采用，接入400+款热门游戏。欢迎访问 [www.fair-guard.com](https://www.fair-guard.com) 了解试用。    

产品咨询联系方式：  

QQ：2079128588  

微信：fairguard01  

技术交流QQ群：1105310296  